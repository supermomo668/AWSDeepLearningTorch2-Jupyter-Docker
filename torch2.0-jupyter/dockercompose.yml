version: '3.0'
services:
  dl:
    stdin_open: true  # docker run -i
    tty: true        # docker run -t
    user: root
    # image: pytorch/pytorch:2.0.0-cuda11.7-cudnn8-devel
    ports:
      - 8888:8888
      - 8000:8000
      - 8890:8890
    # change command 
    # command: bash
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    build:
      context: ./
      dockerfile: ./docker-common/DOCKERFILE
    working_dir: /root/projects
    container_name: dl
    # running in privileged
    privileged: true
    devices:
      - /dev/fuse
    environment:
      - FUSE_DEBUG=1
    volumes: 
      # extremely important `delegated` flag to support intensive I/O operations in environ
      - /c/Users/Mo/Documents/GitHub/Projects:/root/projects:delegated
      - //var/run/docker.sock://var/run/docker.sock
      - /c/Users/Mo/.ssh/:/root/.ssh/
      - /c/Users/Mo/.aws/:/root/.aws/
volumes:
  projects:
  docker:
  ssh:
  aws: